<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BCovrin Indy Network</title>
  <link href="/include/css/index.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/vue@2.5.17/dist/vue.js"></script>
  <script src="/include/js/common.js"></script>
</head>
<body>
  <header>
    <h1><a href="/">BCovrin</a></h1>
    <p class="lead">BC's Provisional Indy Network</p>
  </header>

  <main>
    <div class="row-outer">
      <div class="col-main">
        <div id="vue-ledger">
          <div class="panel panel-default panel-ledger-data">
            <div class="panel-heading">
              <h2>
                Ledger Transactions
              </h2>
            </div>
            <div class="panel-body" style="display: none" v-show="true">
              <div class="ledger-nav" v-if="nav.ident">
                <a href="#" @click.prevent="showEntry(null)"><span class="fa fa-chevron-left"></span> Back to list</a>
              </div>
              <div class="ledger-nav">
                <div class="filter">
                  <select class="tool-input" @change="showLedger($event.target.value)">
                    <option>(Select ledger)</option>
                    <option v-for="opt in ledger_options" :value="opt.value" :selected="opt.value == ledger">{{opt.label}}</option>
                  </select>
                  <input class="tool-input" placeholder="Transaction" size="20" :value="ident" @keyup.enter="showEntry($event.target.value)" @focus="$event.target.select()">
                </div>
                <div class="loading">
                  <p v-if="loading">
                    <span class="fa fa-circle-o-notch fa-spin fa-fw"></span> Loading transactions ...
                  </p>
                </div>
                <ul class="pagination" v-if="nav.loaded">
                  <li class="page-item" v-if="nav.has_prev">
                    <a class="page-link" href="#" @click.prevent="prevPage" aria-label="Previous">
                      <span aria-hidden="true" class="fa fa-chevron-left"></span> Previous
                    </a>
                  </li>
                  <li class="page-item disabled" v-else>
                    <label class="page-link">
                      <span aria-hidden="true" class="fa fa-chevron-left"></span> Previous
                    </label>
                  </li>
                  <li v-for="p in nav.pages" :class="'page-item' + (p.active ? ' active' : '')">
                    <a class="page-link" href="#" @click.prevent="gotoPage(p.index)">{{p.index}}</a>
                  </li>
                  <li class="page-item" v-if="nav.has_next">
                    <a class="page-link" href="#" @click.prevent="nextPage" aria-label="Next">
                      Next <span aria-hidden="true" class="fa fa-chevron-right"></span>
                    </a>
                  </li>
                  <li class="page-item disabled" v-else>
                    <label class="page-link">
                      Next <span aria-hidden="true" class="fa fa-chevron-right"></span>
                    </label>
                  </li>
                </ul>
              </div>
              <div class="error" v-if="error">
                <p>
                  <span class="fa fa-warning"></span> {{error}}
                </p>
              </div>
              <template v-if="loaded">
                <table class="ledger-data" v-if="txns.length">
                  <tbody>
                    <tr class="ledger-row" v-for="entry in txns">
                      <td class="ledger-index"><a :href="entryUrl(entry.txnMetadata.seqNo)" class="number" @click.prevent="showEntry(entry.txnMetadata.seqNo)">#{{entry.txnMetadata.seqNo}}</a></td>
                      <td class="ledger-entry">
                        <div class="ledger-entry-title">
                          Message Wrapper
                        </div>
                        <div v-if="entry.txnMetadata.txnId" class="line misc">
                          <label>Transaction ID:</label> <a :href="entryUrl(entry.txnMetadata.txnId)" @click.prevent="showEntry(entry.txnMetadata.txnId)" class="ident">{{entry.txnMetadata.txnId}}</a>
                        </div>
                        <div v-if="entry.txnMetadata.txnTime" class="line misc">
                          <label>Transaction time:</label> <span class="ident">{{entry.txnMetadata.txnTime | format_time}} ({{entry.txnMetadata.txnTime}})</span>
                        </div>
                        <div v-if="entry.reqSignature && entry.reqSignature.values" class="line misc">
                          <label>Signed by:</label> <span class="ident">{{entry.reqSignature.values[0].from}}</span>
                        </div>
                        <div v-if="entry.rootHash" class="line misc">
                          <label>Root hash:</label> <span class="ident">{{entry.rootHash}}</span>
                        </div>
                        <div v-if="entry.auditPath && entry.auditPath.length" class="line misc">
                          <label>Audit path:</label> <span class="ident">{{entry.auditPath | concat}}</span>
                        </div>
                        <template v-if="entry.txn && entry.txn.metadata && entry.txn.metadata.from">
                          <div class="ledger-entry-title">
                            Metadata
                          </div>
                          <div v-if="entry.txn.metadata.from" class="line misc">
                            <label>From nym:</label> <span class="ident">{{entry.txn.metadata.from}}</span>
                          </div>
                          <div v-if="entry.txn.metadata.reqId" class="line misc">
                            <label>Request ID:</label> <span class="ident">{{entry.txn.metadata.reqId}}</span>
                          </div>
                          <div v-if="entry.txn.metadata.digest" class="line misc">
                            <label>Digest:</label> <span class="ident">{{entry.txn.metadata.digest}}</span>
                          </div>
                        </template>
                        <div class="ledger-entry-title">
                          Transaction
                        </div>
                        <div class="line misc">
                          <label>Type:</label> <span class="ident">{{txnType(entry.txn.type)}}</span>
                        </div>
                        <template v-if="entry.txn.type == '0'">
                          <div class="line misc" v-if="entry.txn.data.data.alias">
                            <label>Alias:</label> <span class="ident">{{entry.txn.data.data.alias}}</span>
                          </div>
                          <div class="line misc">
                            <label>Nym:</label> <span class="ident">{{entry.txn.data.dest}}</span>
                          </div>
                          <div class="line misc" v-if="entry.txn.data.data.client_ip">
                            <label>Client IP:</label> <span class="ident">{{entry.txn.data.data.client_ip}}</span>
                          </div>
                          <div class="line misc" v-if="entry.txn.data.data.client_port">
                            <label>Client port:</label> <span class="ident">{{entry.txn.data.data.client_port}}</span>
                          </div>
                          <div class="line misc" v-if="entry.txn.data.data.node_ip">
                            <label>Node IP:</label> <span class="ident">{{entry.txn.data.data.node_ip}}</span>
                          </div>
                          <div class="line misc" v-if="entry.txn.data.data.node_port">
                            <label>Node port:</label> <span class="ident">{{entry.txn.data.data.node_port}}</span>
                          </div>
                          <div class="line misc" v-if="entry.txn.data.data.services">
                            <label>Services:</label> <span class="ident">{{entry.txn.data.data.services | concat}}</span>
                          </div>
                        </template>
                        <template v-if="entry.txn.type == '1'">
                          <div class="line misc" v-if="entry.txn.data.alias">
                            <label>Alias:</label> <span class="ident">{{entry.txn.data.alias}}</span>
                          </div>
                          <div class="line misc">
                            <label>Nym:</label> <span class="ident">{{entry.txn.data.dest}}</span>
                          </div>
                          <div class="line misc">
                            <label>Role:</label> <span class="ident">{{roleType(entry.txn.data.role)}}</span>
                          </div>
                          <div class="line misc">
                            <label>Verkey:</label> <span class="ident">{{entry.txn.data.verkey}}</span>
                          </div>
                        </template>
                        <template v-if="entry.txn.type == '101'">
                          <div class="line misc">
                            <label>Schema name:</label> <span class="ident">{{entry.txn.data.data.name}}</span>
                          </div>
                          <div class="line misc">
                            <label>Schema version:</label> <span class="ident">{{entry.txn.data.data.version}}</span>
                          </div>
                          <div class="line misc" v-if="entry.txn.data.data.attr_names">
                            <label>Schema attributes:</label>
                            <ul>
                              <li v-for="attr in entry.txn.data.data.attr_names" class="ident">
                                {{attr}}
                              </li>
                            </ul>
                          </div>
                        </template>
                        <template v-if="entry.txn.type == '102'">
                          <div class="line misc">
                            <label>Reference:</label> <a :href="entryUrl(entry.txn.data.ref)" @click.prevent="showEntry(entry.txn.data.ref)" class="ident">{{entry.txn.data.ref}}</a>
                          </div>
                          <div class="line misc">
                            <label>Signature type:</label> <span class="ident">{{entry.txn.data.signature_type}}</span>
                          </div>
                          <div class="line misc">
                            <label>Tag:</label> <span class="ident">{{entry.txn.data.tag}}</span>
                          </div>
                          <div class="line misc" v-if="entry.txn.data.data.primary">
                            <label>Attributes:</label>
                            <ul>
                              <li v-for="(hash, attr) in entry.txn.data.data.primary.r" class="ident">
                                {{attr}}
                              </li>
                            </ul>
                        </template>
                        <div class="ledger-entry-title active" @click.prevent="toggleData(entry.index)">
                          Raw Data <span class="fa fa-chevron-down"></span>
                        </div>
                        <div class="raw-data" v-if="entry.expanded">{{entry.json}}</div>
                      </td>
                    </tr>
                  </tbody>
                </table>
                <div class="error" v-else>
                  <p>
                    <span class="fa fa-warning"></span> No transactions
                  </p>
                </div>
              </template>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
  <script src="/include/js/ledger.js" type="text/javascript"></script>
</body>
</html>
